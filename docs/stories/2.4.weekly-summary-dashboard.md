# Story 2.4: Last 7 Days Summary View - Brownfield Addition

## Status
Ready

## Story

**As a** peptide user,
**I want** to see a quick summary of my recent injection activity,
**so that** I can easily track my current weekly protocol compliance.

## Story Context

**Existing System Integration:**

- Integrates with: Injection data from Stories 2.1-2.3, existing dashboard components, user protocols
- Technology: Next.js 15, React 19, TypeScript, Supabase PostgreSQL, existing dashboard widgets
- Follows pattern: Dashboard widget architecture, existing card-based layout from dashboard
- Touch points: Dashboard page, injections database queries, protocol adherence tracking

## Acceptance Criteria

**Functional Requirements:**

1. Dashboard widget showing last 7 days of injection activity
2. Visual timeline or calendar view of recent injections
3. Quick stats showing total doses, unique peptides, and injection sites used
4. Identification of missed doses based on expected protocols
5. Direct links to edit or add injections for specific days
6. Visual indicators for protocol adherence and potential issues
7. Responsive design optimized for both mobile and desktop viewing

**Integration Requirements:**

4. Existing dashboard functionality continues to work unchanged
5. New functionality follows existing dashboard widget pattern
6. Integration with injection data uses established query patterns from DatabaseService

**Quality Requirements:**

7. Change is covered by appropriate tests
8. Documentation is updated if needed
9. No regression in existing functionality verified

## Technical Notes

- **Integration Approach:** Create WeeklySummaryWidget component following existing dashboard card patterns, extend DatabaseService with 7-day query methods
- **Existing Pattern Reference:** Follow existing dashboard card layout from dashboard/page.tsx, similar widget architecture for consistent styling
- **Key Constraints:** Must integrate seamlessly with existing dashboard, follow established responsive design patterns

## Definition of Done

- [ ] Functional requirements met
- [ ] Integration requirements verified
- [ ] Existing functionality regression tested
- [ ] Code follows existing patterns and standards
- [ ] Tests pass (existing and new)
- [ ] Documentation updated if applicable

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Dashboard widget performance with complex injection data aggregation
- **Mitigation:** Implement efficient 7-day queries, cache recent data, follow existing dashboard patterns
- **Rollback:** Remove dashboard widget, no database changes required

**Compatibility Verification:**

- [ ] No breaking changes to existing APIs
- [ ] Database changes (if any) are query-only using existing injections table
- [ ] UI changes follow existing dashboard widget patterns
- [ ] Performance impact is minimal with focused 7-day data scope

## Tasks / Subtasks

- [ ] Extend DatabaseService with weekly summary queries
  - [ ] Add getLast7DaysInjections method with aggregation
  - [ ] Implement injection statistics calculation (totals, unique peptides, sites)
  - [ ] Add protocol adherence checking logic
  - [ ] Create missed dose identification functionality

- [ ] Create weekly summary widget component
  - [ ] Build WeeklySummaryWidget following dashboard card patterns
  - [ ] Implement visual timeline/calendar view of recent injections
  - [ ] Add quick stats display (doses, peptides, sites)
  - [ ] Include protocol adherence indicators

- [ ] Create missed dose identification system
  - [ ] Analyze user's injection patterns for expected frequency
  - [ ] Identify gaps in injection schedule
  - [ ] Provide visual indicators for missed doses
  - [ ] Add quick action buttons for missed injections

- [ ] Integrate widget into dashboard
  - [ ] Add WeeklySummaryWidget to dashboard page
  - [ ] Implement responsive design for mobile/desktop
  - [ ] Add direct navigation links to injection logging and history
  - [ ] Include loading states and error handling

- [ ] Add protocol adherence tracking
  - [ ] Create visual indicators for protocol compliance
  - [ ] Add trend indicators (improving/declining adherence)
  - [ ] Include quick actions for protocol adjustments

## Dev Notes

### Architecture References

**Component Architecture:**
- Follow existing dashboard card structure from dashboard/page.tsx
- Reuse responsive grid patterns and card styling
- Follow established loading state and error handling patterns

**Database Integration:**
- Extend DatabaseService with 7-day aggregation queries
- Use existing injections table with date filtering
- Follow established user-specific data patterns

**Widget Layout:**
```typescript
interface WeeklySummaryData {
  totalInjections: number;
  uniquePeptides: string[];
  injectionSites: InjectionSite[];
  dailyActivity: DailyInjectionSummary[];
  missedDoses: Date[];
  adherenceScore: number;
}
```

**Visual Components:**
- 7-day calendar/timeline view
- Quick stats cards (total doses, peptides, sites)
- Protocol adherence indicators
- Missed dose alerts
- Quick action buttons (log injection, view history)

**Mobile Optimization:**
- Collapsible sections for mobile
- Swipeable timeline view
- Touch-friendly action buttons
- Responsive stats layout

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-29 | 1.0 | Initial story creation for weekly summary dashboard widget | John (PM) |

## Dev Agent Record

*(This section will be populated by the development agent during implementation)*

### Agent Model Used
*(To be filled by dev agent)*

### Debug Log References
*(To be filled by dev agent)*

### Completion Notes List
*(To be filled by dev agent)*

### File List
*(To be filled by dev agent)*

## QA Results

*(This section will be populated by QA Agent after story completion)*