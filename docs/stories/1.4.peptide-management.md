# Story 1.4: Basic Peptide Management

## Status
Draft

## Story

**As a** user,
**I want** to manage my personal peptide library with pre-configured and custom peptides,
**so that** I can set up the peptides I use for injection tracking.

## Acceptance Criteria

1. Peptide library interface displaying available peptides with dosing information
2. Add custom peptide functionality with name, typical dosing, and notes
3. Edit existing peptides in personal library with proper validation
4. Delete peptides from personal library with confirmation and dependency checking
5. Search and filter peptides by name or category
6. Pre-populated database with common peptides used by Jay Campbell's audience
7. Peptide details view showing dosing recommendations and usage notes

## Tasks / Subtasks

- [ ] Create peptide library interface (AC: 1)
  - [ ] Design peptide library page layout
  - [ ] Create peptide card components for display
  - [ ] Implement grid/list view for peptide library
  - [ ] Add loading states and empty states
  - [ ] Connect to tRPC peptides API

- [ ] Implement add custom peptide functionality (AC: 2)
  - [ ] Create add peptide form with validation
  - [ ] Implement peptide name and category selection
  - [ ] Add typical dosing range configuration
  - [ ] Include safety notes and usage guidelines
  - [ ] Test form validation and submission

- [ ] Create edit peptide functionality (AC: 3)
  - [ ] Create edit peptide form (reuse add form components)
  - [ ] Implement peptide data loading for editing
  - [ ] Add validation for peptide updates
  - [ ] Handle pre-configured vs custom peptide differences
  - [ ] Test edit functionality and data persistence

- [ ] Implement delete peptide functionality (AC: 4)
  - [ ] Create delete confirmation dialog
  - [ ] Check for existing injection dependencies
  - [ ] Implement soft delete for peptides with injection history
  - [ ] Add dependency warning messages
  - [ ] Test deletion with various scenarios

- [ ] Add search and filter functionality (AC: 5)
  - [ ] Implement peptide name search
  - [ ] Add category filtering
  - [ ] Create filter dropdown components
  - [ ] Add search result highlighting
  - [ ] Test search and filter combinations

- [ ] Set up peptide templates and seed data (AC: 6)
  - [ ] Create peptide templates in database
  - [ ] Add common peptides (Semaglutide, BPC-157, etc.)
  - [ ] Include typical dosing information
  - [ ] Add Jay Campbell content references
  - [ ] Test template peptide creation for new users

- [ ] Create peptide details view (AC: 7)
  - [ ] Design peptide detail page/modal
  - [ ] Display comprehensive peptide information
  - [ ] Show dosing recommendations and guidelines
  - [ ] Include safety notes and warnings
  - [ ] Add links to Jay Campbell content if available
  - [ ] Include injection history summary for the peptide

## Dev Notes

### Architecture References

**Component Architecture:**
- Use shadcn/ui components for consistent design
- Implement responsive design for mobile and desktop
- Follow atomic design principles (atoms, molecules, organisms)
- Use Zustand for local state management

**tRPC API Routes:**
```typescript
// Peptides router endpoints
const peptidesRouter = router({
  getAll: protectedProcedure.query(),
  create: protectedProcedure.input(createPeptideSchema).mutation(),
  update: protectedProcedure.input(updatePeptideSchema).mutation(),
  delete: protectedProcedure.input(deletePeptideSchema).mutation(),
});
```

**Data Validation with Zod:**
```typescript
const createPeptideSchema = z.object({
  name: z.string().min(1).max(100),
  category: z.enum(['weight_loss', 'muscle_growth', 'recovery', 'cognitive', 'longevity', 'custom']),
  typicalDoseRange: z.object({
    min: z.number().positive(),
    max: z.number().positive(),
    unit: z.enum(['mg', 'mcg', 'iu', 'ml']),
    frequency: z.enum(['daily', 'weekly', 'bi_weekly', 'monthly', 'as_needed']),
  }),
  safetyNotes: z.array(z.string()).optional(),
});
```

**Component Structure:**
```
src/components/peptides/
├── PeptideLibrary.tsx       # Main library page
├── PeptideCard.tsx          # Individual peptide display
├── PeptideForm.tsx          # Add/edit peptide form
├── PeptideDetail.tsx        # Detailed peptide view
├── PeptideFilters.tsx       # Search and filter controls
└── DeletePeptideDialog.tsx  # Confirmation dialog
```

**State Management:**
```typescript
interface PeptideState {
  peptides: Peptide[];
  selectedPeptide: Peptide | null;
  searchQuery: string;
  selectedCategory: string | null;
  isLoading: boolean;
}
```

**Common Peptides for Seeding:**
- Semaglutide (weight loss, 0.25-2.4mg weekly)
- BPC-157 (recovery, 250-500mcg daily)
- CJC-1295 (muscle growth, 100-200mcg weekly)
- Ipamorelin (muscle growth, 200-300mcg daily)
- PT-141 (cognitive, 1.75-2mg as needed)
- Melanotan II (aesthetic, 0.25-1mg daily)

**Design System Integration:**
- Primary color: #ff3427
- Dark theme with high contrast
- Antonio font for headings
- Poppins for body text
- Responsive grid layout for peptide cards

**Navigation Integration:**
```
/peptides                    # Main library page
/peptides/add               # Add new peptide
/peptides/[id]              # Peptide detail view
/peptides/[id]/edit         # Edit peptide
```

**Error Handling:**
- Form validation with real-time feedback
- Network error handling with retry options
- Dependency checking before deletion
- User-friendly error messages

**Performance Considerations:**
- Implement virtual scrolling for large peptide lists
- Use React Query for caching and optimistic updates
- Lazy load peptide details
- Optimize search with debouncing

### Testing

**Component Testing:**
- Test all CRUD operations for peptides
- Verify form validation and error handling
- Test search and filter functionality
- Validate responsive design across screen sizes

**Integration Testing:**
- Test tRPC API integration
- Verify database operations
- Test authentication requirements
- Validate data persistence

**User Experience Testing:**
- Test peptide creation flow
- Verify edit and delete workflows
- Test search and discovery features
- Validate mobile and desktop experiences

**Test Scenarios:**
- Create peptide with valid/invalid data
- Edit pre-configured vs custom peptides
- Delete peptide with/without injection history
- Search peptides with various queries
- Filter peptides by different categories

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-29 | 1.0 | Initial story creation for peptide management | Sarah (PO) |

## Dev Agent Record

*(This section will be populated by the development agent during implementation)*

### Agent Model Used
*(To be filled by dev agent)*

### Debug Log References
*(To be filled by dev agent)*

### Completion Notes List
*(To be filled by dev agent)*

### File List
*(To be filled by dev agent)*

## QA Results

*(This section will be populated by QA Agent after story completion)*