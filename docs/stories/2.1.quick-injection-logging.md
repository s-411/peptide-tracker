# Story 2.1: Quick Injection Logging Interface - Brownfield Addition

## Status
Ready

## Story

**As a** peptide user,
**I want** to quickly log my injections with minimal clicks and typing,
**so that** I can maintain accurate records without disrupting my routine.

## Story Context

**Existing System Integration:**

- Integrates with: Existing peptide management system and user authentication
- Technology: Next.js 15, React 19, TypeScript, Supabase PostgreSQL, Clerk auth
- Follows pattern: Form components, DatabaseService CRUD operations, page routing structure
- Touch points: Peptide library for selection, injections database table, user authentication context

## Acceptance Criteria

**Functional Requirements:**

1. Streamlined injection logging form accessible from dashboard and navigation
2. Peptide selection dropdown populated from user's peptide library
3. Dose amount input with validation against typical ranges for selected peptide
4. Date and time picker defaulting to current time with easy adjustment
5. Injection site selection from predefined body locations with visual guide
6. Optional notes field for tracking side effects, observations, or protocol changes
7. Form submission creates injection record and returns to appropriate view with success confirmation

**Integration Requirements:**

4. Existing peptide management functionality continues to work unchanged
5. New functionality follows existing form component and validation pattern
6. Integration with DatabaseService maintains current CRUD operation approach

**Quality Requirements:**

7. Change is covered by appropriate tests
8. Documentation is updated if needed
9. No regression in existing functionality verified

## Technical Notes

- **Integration Approach:** Extend existing DatabaseService with injection operations, create new injection components following peptide management patterns, add navigation links to dashboard
- **Existing Pattern Reference:** Follow PeptideForm.tsx structure for form validation, PeptideLibrary.tsx for data loading patterns, and dashboard page.tsx for navigation integration
- **Key Constraints:** Must integrate with existing database schema (injections table), follow established design system and styling patterns

## Definition of Done

- [ ] Functional requirements met
- [ ] Integration requirements verified
- [ ] Existing functionality regression tested
- [ ] Code follows existing patterns and standards
- [ ] Tests pass (existing and new)
- [ ] Documentation updated if applicable

## Risk and Compatibility Check

**Minimal Risk Assessment:**

- **Primary Risk:** Form validation complexity with dose ranges and injection site data
- **Mitigation:** Follow existing peptide form validation patterns and reuse established validation schemas
- **Rollback:** Remove new injection routes and components, database operations are additive only

**Compatibility Verification:**

- [ ] No breaking changes to existing APIs
- [ ] Database changes (if any) are additive only - using existing injections table
- [ ] UI changes follow existing design patterns from peptide management
- [ ] Performance impact is negligible - similar to existing peptide operations

## Tasks / Subtasks

- [ ] Create injection logging form component following PeptideForm pattern
  - [ ] Implement peptide selection dropdown using user's peptide library
  - [ ] Add dose input with validation against peptide typical ranges
  - [ ] Create date/time picker with current time default
  - [ ] Build injection site selection with predefined locations
  - [ ] Add optional notes field
  - [ ] Implement form submission with validation

- [ ] Extend DatabaseService with injection operations
  - [ ] Add createInjection method following existing pattern
  - [ ] Implement injection validation logic
  - [ ] Test database integration with existing injection table schema

- [ ] Create injection logging page and routing
  - [ ] Create /injections/log page following existing page structure
  - [ ] Add navigation integration to dashboard
  - [ ] Implement success/error handling and user feedback

- [ ] Add injection site data and validation
  - [ ] Define injection site enum/types matching database schema
  - [ ] Create visual injection site selector component
  - [ ] Implement dose range validation using peptide data

## Dev Notes

### Architecture References

**Component Architecture:**
- Follow existing peptide management component structure
- Reuse form validation patterns from PeptideForm.tsx
- Follow dashboard integration pattern for navigation

**Database Integration:**
- Extend existing DatabaseService class with injection methods
- Use existing injections table schema from Story 1.3
- Follow established user authentication patterns

**Form Structure:**
```typescript
interface InjectionFormData {
  peptideId: string;
  dose: number;
  doseUnit: string;
  injectionSite: InjectionSite;
  timestamp: Date;
  notes?: string;
}
```

**Injection Site Options:**
- Abdomen (multiple sub-locations)
- Thigh (left/right)
- Arm (left/right)
- Glute (left/right)
- Shoulder (left/right)

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-09-29 | 1.0 | Initial story creation for quick injection logging | John (PM) |

## Dev Agent Record

*(This section will be populated by the development agent during implementation)*

### Agent Model Used
*(To be filled by dev agent)*

### Debug Log References
*(To be filled by dev agent)*

### Completion Notes List
*(To be filled by dev agent)*

### File List
*(To be filled by dev agent)*

## QA Results

*(This section will be populated by QA Agent after story completion)*